function Compiling(a,b){this.c_encoding=a,this.c_filename=b}function NCH(a){return goog.asserts.assert(void 0!==a),null===a.children?0:a.children.length}function CHILD(a,b){return goog.asserts.assert(void 0!==a),goog.asserts.assert(void 0!==b),a.children[b]}function REQ(a,b){goog.asserts.assert(a.type===b,"node wasn't expected type")}function strobj(a){return goog.asserts.assert("string"==typeof a,"expecting string, got "+typeof a),new Sk.builtin.str(a)}function numStmts(a){switch(a.type){case SYM.single_input:return CHILD(a,0).type===TOK.T_NEWLINE?0:numStmts(CHILD(a,0));case SYM.file_input:for(var b=0,c=0;NCH(a)>c;++c){var d=CHILD(a,c);d.type===SYM.stmt&&(b+=numStmts(d))}return b;case SYM.stmt:return numStmts(CHILD(a,0));case SYM.compound_stmt:return 1;case SYM.simple_stmt:return Math.floor(NCH(a)/2);case SYM.suite:if(1===NCH(a))return numStmts(CHILD(a,0));for(var b=0,c=2;NCH(a)-1>c;++c)b+=numStmts(CHILD(a,c));return b;default:goog.asserts.fail("Non-statement found")}return 0}function forbiddenCheck(a,b,c){if("None"===c)throw new Sk.builtin.SyntaxError("assignment to None");if("True"===c||"False"===c)throw new Sk.builtin.SyntaxError("assignment to True or False is forbidden")}function setContext(a,b,c,d){goog.asserts.assert(c!==AugStore&&c!==AugLoad);var e=null,f=null;switch(b.constructor){case Attribute:case Name:c===Store&&forbiddenCheck(a,d,b.attr),b.ctx=c;break;case Subscript:b.ctx=c;break;case List:b.ctx=c,e=b.elts;break;case Tuple:if(0===b.elts.length)throw new Sk.builtin.SyntaxError("can't assign to ()");b.ctx=c,e=b.elts;break;case Lambda:f="lambda";break;case Call:f="function call";break;case BoolOp:case BinOp:case UnaryOp:f="operator";break;case GeneratorExp:f="generator expression";break;case Yield:f="yield expression";break;case ListComp:f="list comprehension";break;case Dict:case Num:case Str:f="literal";break;case Compare:f="comparison";break;case IfExp:f="conditional expression";break;default:goog.asserts.fail("unhandled expression in assignment")}if(f)throw new Sk.builtin.SyntaxError("can't "+(c===Store?"assign to":"delete")+" "+f);if(e)for(var g=0;e.length>g;++g)setContext(a,e[g],c,d)}function getOperator(a){return goog.asserts.assert(void 0!==operatorMap[a.type]),operatorMap[a.type]}function astForCompOp(a,b){if(REQ(b,SYM.comp_op),1===NCH(b))switch(b=CHILD(b,0),b.type){case TOK.T_LESS:return Lt;case TOK.T_GREATER:return Gt;case TOK.T_EQEQUAL:return Eq;case TOK.T_LESSEQUAL:return LtE;case TOK.T_GREATEREQUAL:return GtE;case TOK.T_NOTEQUAL:return NotEq;case TOK.T_NAME:if("in"===b.value)return In_;if("is"===b.value)return Is}else if(2===NCH(b)&&CHILD(b,0).type===TOK.T_NAME){if("in"===CHILD(b,1).value)return NotIn;if("is"===CHILD(b,0).value)return IsNot}goog.asserts.fail("invalid comp_op")}function seqForTestlist(a,b){goog.asserts.assert(b.type===SYM.testlist||b.type===SYM.listmaker||b.type===SYM.testlist_gexp||b.type===SYM.testlist_safe||b.type===SYM.testlist1);for(var c=[],d=0;NCH(b)>d;d+=2)goog.asserts.assert(CHILD(b,d).type===SYM.test||CHILD(b,d).type===SYM.old_test),c[d/2]=astForExpr(a,CHILD(b,d));return c}function astForSuite(a,b){REQ(b,SYM.suite);var e,c=[],d=0;if(CHILD(b,0).type===SYM.simple_stmt){b=CHILD(b,0);var f=NCH(b)-1;CHILD(b,f-1).type===TOK.T_SEMI&&(f-=1);for(var g=0;f>g;g+=2)c[d++]=astForStmt(a,CHILD(b,g))}else for(var g=2;NCH(b)-1>g;++g){e=CHILD(b,g),REQ(e,SYM.stmt);var h=numStmts(e);if(1===h)c[d++]=astForStmt(a,e);else{e=CHILD(e,0),REQ(e,SYM.simple_stmt);for(var i=0;NCH(e)>i;i+=2){if(0===NCH(CHILD(e,i))){goog.asserts.assert(i+1===NCH(e));break}c[d++]=astForStmt(a,CHILD(e,i))}}}return goog.asserts.assert(d===numStmts(b)),c}function astForExceptClause(a,b,c){if(REQ(b,SYM.except_clause),REQ(c,SYM.suite),1===NCH(b))return new ExceptHandler(null,null,astForSuite(a,c),b.lineno,b.col_offset);if(2===NCH(b))return new ExceptHandler(astForExpr(a,CHILD(b,1)),null,astForSuite(a,c),b.lineno,b.col_offset);if(4===NCH(b)){var d=astForExpr(a,CHILD(b,3));return setContext(a,d,Store,CHILD(b,3)),new ExceptHandler(astForExpr(a,CHILD(b,1)),d,astForSuite(a,c),b.lineno,b.col_offset)}goog.asserts.fail("wrong number of children for except clause")}function astForTryStmt(a,b){var e,c=NCH(b),d=(c-3)/3,f=[],g=null;if(REQ(b,SYM.try_stmt),e=astForSuite(a,CHILD(b,2)),CHILD(b,c-3).type===TOK.T_NAME)"finally"===CHILD(b,c-3).value?(c>=9&&CHILD(b,c-6).type===TOK.T_NAME&&(f=astForSuite(a,CHILD(b,c-4)),d--),g=astForSuite(a,CHILD(b,c-1)),d--):(f=astForSuite(a,CHILD(b,c-1)),d--);else if(CHILD(b,c-3).type!==SYM.except_clause)throw new Sk.builtin.SyntaxError("malformed 'try' statement");if(d>0){for(var h=[],i=0;d>i;++i)h[i]=astForExceptClause(a,CHILD(b,3+3*i),CHILD(b,5+3*i));var j=new TryExcept(e,h,f,b.lineno,b.col_offset);if(!g)return j;e=[j]}return goog.asserts.assert(null!==g),new TryFinally(e,g,b.lineno,b.col_offset)}function astForDottedName(a,b){REQ(b,SYM.dotted_name);for(var c=b.lineno,d=b.col_offset,e=strobj(CHILD(b,0).value),f=new Name(e,Load,c,d),g=2;NCH(b)>g;g+=2)e=strobj(CHILD(b,g).value),f=new Attribute(f,e,Load,c,d);return f}function astForDecorator(a,b){REQ(b,SYM.decorator),REQ(CHILD(b,0),TOK.T_AT),REQ(CHILD(b,NCH(b)-1),TOK.T_NEWLINE);var c=astForDottedName(a,CHILD(b,1));return 3===NCH(b)?c:5===NCH(b)?new Call(c,[],[],null,null,b.lineno,b.col_offset):astForCall(a,CHILD(b,3),c)}function astForDecorators(a,b){REQ(b,SYM.decorators);for(var c=[],d=0;NCH(b)>d;++d)c[d]=astForDecorator(a,CHILD(b,d));return c}function astForDecorated(a,b){REQ(b,SYM.decorated);var c=astForDecorators(a,CHILD(b,0));goog.asserts.assert(CHILD(b,1).type===SYM.funcdef||CHILD(b,1).type===SYM.classdef);var d=null;return CHILD(b,1).type===SYM.funcdef?d=astForFuncdef(a,CHILD(b,1),c):CHILD(b,1)===SYM.classdef&&(d=astForClassdef(a,CHILD(b,1),c)),d&&(d.lineno=b.lineno,d.col_offset=b.col_offset),d}function astForWithVar(a,b){return REQ(b,SYM.with_var),astForExpr(a,CHILD(b,1))}function astForWithStmt(a,b){var c=3;goog.asserts.assert(b.type===SYM.with_stmt);var d=astForExpr(a,CHILD(b,1));if(CHILD(b,2).type===SYM.with_var){var e=astForWithVar(a,CHILD(b,2));setContext(a,e,Store,b),c=4}return new With_(d,e,astForSuite(a,CHILD(b,c)),b.lineno,b.col_offset)}function astForExecStmt(a,b){var c,d=null,e=null,f=NCH(b);goog.asserts.assert(2===f||4===f||6===f),REQ(b,SYM.exec_stmt);var c=astForExpr(a,CHILD(b,1));return f>=4&&(d=astForExpr(a,CHILD(b,3))),6===f&&(e=astForExpr(a,CHILD(b,5))),new Exec(c,d,e,b.lineno,b.col_offset)}function astForIfStmt(a,b){if(REQ(b,SYM.if_stmt),4===NCH(b))return new If_(astForExpr(a,CHILD(b,1)),astForSuite(a,CHILD(b,3)),[],b.lineno,b.col_offset);var c=CHILD(b,4).value,d=c.charAt(2);if("s"===d)return new If_(astForExpr(a,CHILD(b,1)),astForSuite(a,CHILD(b,3)),astForSuite(a,CHILD(b,6)),b.lineno,b.col_offset);if("i"===d){var e=NCH(b)-4,f=!1,g=[];CHILD(b,e+1).type===TOK.T_NAME&&"s"===CHILD(b,e+1).value.charAt(2)&&(f=!0,e-=3),e/=4,f&&(g=[new If_(astForExpr(a,CHILD(b,NCH(b)-6)),astForSuite(a,CHILD(b,NCH(b)-4)),astForSuite(a,CHILD(b,NCH(b)-1)),CHILD(b,NCH(b)-6).lineno,CHILD(b,NCH(b)-6).col_offset)],e--);for(var h=0;e>h;++h){var i=5+4*(e-h-1);g=[new If_(astForExpr(a,CHILD(b,i)),astForSuite(a,CHILD(b,i+2)),g,CHILD(b,i).lineno,CHILD(b,i).col_offset)]}return new If_(astForExpr(a,CHILD(b,1)),astForSuite(a,CHILD(b,3)),g,b.lineno,b.col_offset)}goog.asserts.fail("unexpected token in 'if' statement")}function astForExprlist(a,b,c){REQ(b,SYM.exprlist);for(var d=[],e=0;NCH(b)>e;e+=2){var f=astForExpr(a,CHILD(b,e));d[e/2]=f,c&&setContext(a,f,c,CHILD(b,e))}return d}function astForDelStmt(a,b){return REQ(b,SYM.del_stmt),new Delete_(astForExprlist(a,CHILD(b,1),Del),b.lineno,b.col_offset)}function astForGlobalStmt(a,b){REQ(b,SYM.global_stmt);for(var c=[],d=1;NCH(b)>d;d+=2)c[(d-1)/2]=strobj(CHILD(b,d).value);return new Global(c,b.lineno,b.col_offset)}function astForAssertStmt(a,b){return REQ(b,SYM.assert_stmt),2===NCH(b)?new Assert(astForExpr(a,CHILD(b,1)),null,b.lineno,b.col_offset):4===NCH(b)?new Assert(astForExpr(a,CHILD(b,1)),astForExpr(a,CHILD(b,3)),b.lineno,b.col_offset):(goog.asserts.fail("improper number of parts to assert stmt"),void 0)}function aliasForImportName(a,b){a:for(;;){switch(b.type){case SYM.import_as_name:var c=null,d=strobj(CHILD(b,0).value);return 3===NCH(b)&&(c=CHILD(b,2).value),new alias(d,null==c?null:strobj(c));case SYM.dotted_as_name:if(1===NCH(b)){b=CHILD(b,0);continue a}var e=aliasForImportName(a,CHILD(b,0));return goog.asserts.assert(!e.asname),e.asname=strobj(CHILD(b,2).value),e;case SYM.dotted_name:if(1===NCH(b))return new alias(strobj(CHILD(b,0).value),null);for(var c="",f=0;NCH(b)>f;f+=2)c+=CHILD(b,f).value+".";return new alias(strobj(c.substr(0,c.length-1)),null);case TOK.T_STAR:return new alias(strobj("*"),null);default:throw new Sk.builtin.SyntaxError("unexpected import name")}break}}function astForImportStmt(a,b){REQ(b,SYM.import_stmt);var c=b.lineno,d=b.col_offset;if(b=CHILD(b,0),b.type===SYM.import_name){b=CHILD(b,1),REQ(b,SYM.dotted_as_names);for(var e=[],f=0;NCH(b)>f;f+=2)e[f/2]=aliasForImportName(a,CHILD(b,f));return new Import_(e,c,d)}if(b.type===SYM.import_from){for(var i,g=null,h=0,j=1;NCH(b)>j;++j){if(CHILD(b,j).type===SYM.dotted_name){g=aliasForImportName(a,CHILD(b,j)),j++;break}if(CHILD(b,j).type!==TOK.T_DOT)break;h++}switch(++j,CHILD(b,j).type){case TOK.T_STAR:b=CHILD(b,j),i=1;break;case TOK.T_LPAR:b=CHILD(b,j+1),i=NCH(b);break;case SYM.import_as_names:if(b=CHILD(b,j),i=NCH(b),0===i%2)throw new Sk.builtin.SyntaxError("trailing comma not allowed without surrounding parentheses");break;default:throw new Sk.builtin.SyntaxError("Unexpected node-type in from-import")}var e=[];if(b.type===TOK.T_STAR)e[0]=aliasForImportName(a,b);else for(var f=0;NCH(b)>f;f+=2)e[f/2]=aliasForImportName(a,CHILD(b,f));var k=g?g.name.v:"";return new ImportFrom(strobj(k),e,h,c,d)}throw new Sk.builtin.SyntaxError("unknown import statement")}function astForTestlistGexp(a,b){return goog.asserts.assert(b.type===SYM.testlist_gexp||b.type===SYM.argument),NCH(b)>1&&CHILD(b,1).type===SYM.gen_for?astForGenexp(a,b):astForTestlist(a,b)}function astForListcomp(a,b){function c(a,b){var c=0,d=CHILD(b,1);a:for(;;){if(c++,REQ(d,SYM.list_for),5!==NCH(d))return c;d=CHILD(d,4);b:for(;;){if(REQ(d,SYM.list_iter),d=CHILD(d,0),d.type===SYM.list_for)continue a;if(d.type===SYM.list_if){if(3===NCH(d)){d=CHILD(d,2);continue b}return c}break}break}}function d(a,b){for(var c=0;;){if(REQ(b,SYM.list_iter),CHILD(b,0).type===SYM.list_for)return c;if(b=CHILD(b,0),REQ(b,SYM.list_if),c++,2==NCH(b))return c;b=CHILD(b,2)}}REQ(b,SYM.listmaker),goog.asserts.assert(NCH(b)>1);for(var e=astForExpr(a,CHILD(b,0)),f=c(a,b),g=[],h=CHILD(b,1),i=0;f>i;++i){REQ(h,SYM.list_for);var m,j=CHILD(h,1),k=astForExprlist(a,j,Store),l=astForTestlist(a,CHILD(h,3));if(m=1===NCH(j)?new comprehension(k[0],l,[]):new comprehension(new Tuple(k,Store,h.lineno,h.col_offset),l,[]),5===NCH(h)){h=CHILD(h,4);for(var n=d(a,h),o=[],p=0;n>p;++p)REQ(h,SYM.list_iter),h=CHILD(h,0),REQ(h,SYM.list_if),o[p]=astForExpr(a,CHILD(h,1)),3===NCH(h)&&(h=CHILD(h,2));h.type===SYM.list_iter&&(h=CHILD(h,0)),m.ifs=o}g[i]=m}return new ListComp(e,g,b.lineno,b.col_offset)}function astForFactor(a,b){if(CHILD(b,0).type===TOK.T_MINUS&&2===NCH(b)){var c=CHILD(b,1);if(c.type===SYM.factor&&1===NCH(c)){var d=CHILD(c,0);if(d.type===SYM.power&&1===NCH(d)){var e=CHILD(d,0);if(e.type===SYM.atom){var f=CHILD(e,0);if(f.type===TOK.T_NUMBER)return f.value="-"+f.value,astForAtom(a,e)}}}}var g=astForExpr(a,CHILD(b,1));switch(CHILD(b,0).type){case TOK.T_PLUS:return new UnaryOp(UAdd,g,b.lineno,b.col_offset);case TOK.T_MINUS:return new UnaryOp(USub,g,b.lineno,b.col_offset);case TOK.T_TILDE:return new UnaryOp(Invert,g,b.lineno,b.col_offset)}goog.asserts.fail("unhandled factor")}function astForForStmt(a,b){var c=[];REQ(b,SYM.for_stmt),9===NCH(b)&&(c=astForSuite(a,CHILD(b,8)));var f,d=CHILD(b,1),e=astForExprlist(a,d,Store);return f=1===NCH(d)?e[0]:new Tuple(e,Store,b.lineno,b.col_offset),new For_(f,astForTestlist(a,CHILD(b,3)),astForSuite(a,CHILD(b,5)),c,b.lineno,b.col_offset)}function astForCall(a,b,c){REQ(b,SYM.arglist);for(var d=0,e=0,f=0,g=0;NCH(b)>g;++g){var h=CHILD(b,g);h.type===SYM.argument&&(1===NCH(h)?d++:CHILD(h,1).type===SYM.gen_for?f++:e++)}if(f>1||f&&(d||e))throw new Sk.builtin.SyntaxError("Generator expression must be parenthesized if not sole argument");if(d+e+f>255)throw new Sk.builtin.SyntaxError("more than 255 arguments");var i=[],j=[];d=0,e=0;for(var k=null,l=null,g=0;NCH(b)>g;++g){var h=CHILD(b,g);if(h.type===SYM.argument)if(1===NCH(h)){if(e)throw new Sk.builtin.SyntaxError("non-keyword arg after keyword arg");if(k)throw new Sk.builtin.SyntaxError("only named arguments may follow *expression");i[d++]=astForExpr(a,CHILD(h,0))}else if(CHILD(h,1).type===SYM.gen_for)i[d++]=astForGenexp(a,h);else{var m=astForExpr(a,CHILD(h,0));if(m.constructor===Lambda)throw new Sk.builtin.SyntaxError("lambda cannot contain assignment");if(m.constructor!==Name)throw new Sk.builtin.SyntaxError("keyword can't be an expression");var n=m.id;forbiddenCheck(a,CHILD(h,0),n);for(var o=0;e>o;++o){var p=j[o].arg;if(p===n)throw new Sk.builtin.SyntaxError("keyword argument repeated")}j[e++]=new keyword(n,astForExpr(a,CHILD(h,2)))}else h.type===TOK.T_STAR?k=astForExpr(a,CHILD(b,++g)):h.type===TOK.T_DOUBLESTAR&&(l=astForExpr(a,CHILD(b,++g)))}return new Call(c,i,j,k,l,c.lineno,c.col_offset)}function astForTrailer(a,b,c){if(REQ(b,SYM.trailer),CHILD(b,0).type===TOK.T_LPAR)return 2===NCH(b)?new Call(c,[],[],null,null,b.lineno,b.col_offset):astForCall(a,CHILD(b,1),c);if(CHILD(b,0).type===TOK.T_DOT)return new Attribute(c,strobj(CHILD(b,1).value),Load,b.lineno,b.col_offset);if(REQ(CHILD(b,0),TOK.T_LSQB),REQ(CHILD(b,2),TOK.T_RSQB),b=CHILD(b,1),1===NCH(b))return new Subscript(c,astForSlice(a,CHILD(b,0)),Load,b.lineno,b.col_offset);for(var d=!0,e=[],f=0;NCH(b)>f;f+=2){var g=astForSlice(a,CHILD(b,f));g.constructor!==Index&&(d=!1),e[f/2]=g}if(!d)return new Subscript(c,new ExtSlice(e),Load,b.lineno,b.col_offset);for(var h=[],f=0;e.length>f;++f){var g=e[f];goog.asserts.assert(g.constructor===Index&&null!==g.value&&void 0!==g.value),h[f]=g.value}var i=new Tuple(h,Load,b.lineno,b.col_offset);return new Subscript(c,new Index(i),Load,b.lineno,b.col_offset)}function astForFlowStmt(a,b){var c;switch(REQ(b,SYM.flow_stmt),c=CHILD(b,0),c.type){case SYM.break_stmt:return new Break_(b.lineno,b.col_offset);case SYM.continue_stmt:return new Continue_(b.lineno,b.col_offset);case SYM.yield_stmt:return new Expr(astForExpr(a,CHILD(c,0)),b.lineno,b.col_offset);case SYM.return_stmt:return 1===NCH(c)?new Return_(null,b.lineno,b.col_offset):new Return_(astForTestlist(a,CHILD(c,1)),b.lineno,b.col_offset);case SYM.raise_stmt:if(1===NCH(c))return new Raise(null,null,null,b.lineno,b.col_offset);if(2===NCH(c))return new Raise(astForExpr(a,CHILD(c,1)),null,null,b.lineno,b.col_offset);if(4===NCH(c))return new Raise(astForExpr(a,CHILD(c,1)),astForExpr(a,CHILD(c,3)),null,b.lineno,b.col_offset);if(6===NCH(c))return new Raise(astForExpr(a,CHILD(c,1)),astForExpr(a,CHILD(c,3)),astForExpr(a,CHILD(c,5)),b.lineno,b.col_offset);default:goog.asserts.fail("unexpected flow_stmt")}goog.asserts.fail("unhandled flow statement")}function astForArguments(a,b){var c,d=null,e=null;if(b.type===SYM.parameters){if(2===NCH(b))return new arguments_([],null,null,[]);b=CHILD(b,1)}REQ(b,SYM.varargslist);for(var f=[],g=[],h=!1,i=0,j=0,k=0;NCH(b)>i;)switch(c=CHILD(b,i),c.type){case SYM.fpdef:for(var l=0,m=0;;){if(NCH(b)>i+1&&CHILD(b,i+1).type===TOK.T_EQUAL)g[j++]=astForExpr(a,CHILD(b,i+2)),i+=2,h=!0;else if(h){if(m&&!l)throw new Sk.builtin.SyntaxError("parenthesized arg with default");throw new Sk.builtin.SyntaxError("non-default argument follows default argument")}{if(3!==NCH(c)){if(CHILD(c,0).type===TOK.T_NAME){forbiddenCheck(a,b,CHILD(c,0).value);var n=strobj(CHILD(c,0).value);f[k++]=new Name(n,Param,c.lineno,c.col_offset)}if(i+=2,m)throw new Sk.builtin.SyntaxError("parenthesized argument names are invalid");break}if(c=CHILD(c,1),1!==NCH(c))throw new Sk.builtin.SyntaxError("tuple parameter unpacking has been removed",this.c_filename,b.lineno);m=!0,c=CHILD(c,0),goog.asserts.assert(c.type===SYM.fpdef)}}break;case TOK.T_STAR:forbiddenCheck(a,CHILD(b,i+1),CHILD(b,i+1).value),d=strobj(CHILD(b,i+1).value),i+=3;break;case TOK.T_DOUBLESTAR:forbiddenCheck(a,CHILD(b,i+1),CHILD(b,i+1).value),e=strobj(CHILD(b,i+1).value),i+=3;break;default:goog.asserts.fail("unexpected node in varargslist")}return new arguments_(f,d,e,g)}function astForFuncdef(a,b,c){REQ(b,SYM.funcdef);var d=strobj(CHILD(b,1).value);forbiddenCheck(a,CHILD(b,1),CHILD(b,1).value);var e=astForArguments(a,CHILD(b,2)),f=astForSuite(a,CHILD(b,4));return new FunctionDef(d,e,f,c,b.lineno,b.col_offset)}function astForClassBases(a,b){return goog.asserts.assert(NCH(b)>0),REQ(b,SYM.testlist),1===NCH(b)?[astForExpr(a,CHILD(b,0))]:seqForTestlist(a,b)}function astForClassdef(a,b,c){REQ(b,SYM.classdef),forbiddenCheck(a,b,CHILD(b,1).value);var d=strobj(CHILD(b,1).value);if(4===NCH(b))return new ClassDef(d,[],astForSuite(a,CHILD(b,3)),c,b.lineno,b.col_offset);if(CHILD(b,3).type===TOK.T_RPAR)return new ClassDef(d,[],astForSuite(a,CHILD(b,5)),c,b.lineno,b.col_offset);var e=astForClassBases(a,CHILD(b,3)),f=astForSuite(a,CHILD(b,6));return new ClassDef(d,e,f,c,b.lineno,b.col_offset)}function astForLambdef(a,b){var c,d;return 3===NCH(b)?(c=new arguments_([],null,null,[]),d=astForExpr(a,CHILD(b,2))):(c=astForArguments(a,CHILD(b,1)),d=astForExpr(a,CHILD(b,3))),new Lambda(c,d,b.lineno,b.col_offset)}function astForGenexp(a,b){function c(a,b){var c=0,d=CHILD(b,1);a:for(;;){if(c++,REQ(d,SYM.gen_for),5!==NCH(d))return c;d=CHILD(d,4);b:for(;;){if(REQ(d,SYM.gen_iter),d=CHILD(d,0),d.type===SYM.gen_for)continue a;if(d.type===SYM.gen_if){if(3===NCH(d)){d=CHILD(d,2);continue b}return c}break}break}goog.asserts.fail("logic error in countGenFors")}function d(a,b){for(var c=0;;){if(REQ(b,SYM.gen_iter),CHILD(b,0).type===SYM.gen_for)return c;if(b=CHILD(b,0),REQ(b,SYM.gen_if),c++,2==NCH(b))return c;b=CHILD(b,2)}}goog.asserts.assert(b.type===SYM.testlist_gexp||b.type===SYM.argument),goog.asserts.assert(NCH(b)>1);for(var e=astForExpr(a,CHILD(b,0)),f=c(a,b),g=[],h=CHILD(b,1),i=0;f>i;++i){REQ(h,SYM.gen_for);var m,j=CHILD(h,1),k=astForExprlist(a,j,Store),l=astForExpr(a,CHILD(h,3));if(m=1===NCH(j)?new comprehension(k[0],l,[]):new comprehension(new Tuple(k,Store,h.lineno,h.col_offset),l,[]),5===NCH(h)){h=CHILD(h,4);for(var n=d(a,h),o=[],p=0;n>p;++p)REQ(h,SYM.gen_iter),h=CHILD(h,0),REQ(h,SYM.gen_if),l=astForExpr(a,CHILD(h,1)),o[p]=l,3===NCH(h)&&(h=CHILD(h,2));h.type===SYM.gen_iter&&(h=CHILD(h,0)),m.ifs=o}g[i]=m}return new GeneratorExp(e,g,b.lineno,b.col_offset)}function astForWhileStmt(a,b){return REQ(b,SYM.while_stmt),4===NCH(b)?new While_(astForExpr(a,CHILD(b,1)),astForSuite(a,CHILD(b,3)),[],b.lineno,b.col_offset):7===NCH(b)?new While_(astForExpr(a,CHILD(b,1)),astForSuite(a,CHILD(b,3)),astForSuite(a,CHILD(b,6)),b.lineno,b.col_offset):(goog.asserts.fail("wrong number of tokens for 'while' stmt"),void 0)}function astForAugassign(a,b){switch(REQ(b,SYM.augassign),b=CHILD(b,0),b.value.charAt(0)){case"+":return Add;case"-":return Sub;case"/":return"/"===b.value.charAt(1)?FloorDiv:Div;case"%":return Mod;case"<":return LShift;case">":return RShift;case"&":return BitAnd;case"^":return BitXor;case"|":return BitOr;case"*":return"*"===b.value.charAt(1)?Pow:Mult;default:goog.asserts.fail("invalid augassign")}}function astForBinop(a,b){for(var c=new BinOp(astForExpr(a,CHILD(b,0)),getOperator(CHILD(b,1)),astForExpr(a,CHILD(b,2)),b.lineno,b.col_offset),d=(NCH(b)-1)/2,e=1;d>e;++e){var f=CHILD(b,2*e+1),g=getOperator(f),h=astForExpr(a,CHILD(b,2*e+2));c=new BinOp(c,g,h,f.lineno,f.col_offset)}return c}function astForTestlist(a,b){return goog.asserts.assert(NCH(b)>0),b.type===SYM.testlist_gexp?NCH(b)>1&&goog.asserts.assert(CHILD(b,1).type!==SYM.gen_for):goog.asserts.assert(b.type===SYM.testlist||b.type===SYM.testlist_safe||b.type===SYM.testlist1),1===NCH(b)?astForExpr(a,CHILD(b,0)):new Tuple(seqForTestlist(a,b),Load,b.lineno,b.col_offset)}function astForExprStmt(a,b){if(REQ(b,SYM.expr_stmt),1===NCH(b))return new Expr(astForTestlist(a,CHILD(b,0)),b.lineno,b.col_offset);if(CHILD(b,1).type===SYM.augassign){var c=CHILD(b,0),d=astForTestlist(a,c);switch(d.constructor){case GeneratorExp:throw new Sk.builtin.SyntaxError("augmented assignment to generator expression not possible");case Yield:throw new Sk.builtin.SyntaxError("augmented assignment to yield expression not possible");case Name:var e=d.id;forbiddenCheck(a,c,e);break;case Attribute:case Subscript:break;default:throw new Sk.builtin.SyntaxError("illegal expression for augmented assignment")}setContext(a,d,Store,c),c=CHILD(b,2);var f;return f=c.type===SYM.testlist?astForTestlist(a,c):astForExpr(a,c),new AugAssign(d,astForAugassign(a,CHILD(b,1)),f,b.lineno,b.col_offset)}REQ(CHILD(b,1),TOK.T_EQUAL);for(var g=[],h=0;NCH(b)-2>h;h+=2){var c=CHILD(b,h);if(c.type===SYM.yield_expr)throw new Sk.builtin.SyntaxError("assignment to yield expression not possible");var i=astForTestlist(a,c);setContext(a,i,Store,CHILD(b,h)),g[h/2]=i}var k,j=CHILD(b,NCH(b)-1);return k=j.type===SYM.testlist?astForTestlist(a,j):astForExpr(a,j),new Assign(g,k,b.lineno,b.col_offset)}function astForIfexpr(a,b){return goog.asserts.assert(5===NCH(b)),new IfExp(astForExpr(a,CHILD(b,2)),astForExpr(a,CHILD(b,0)),astForExpr(a,CHILD(b,4)),b.lineno,b.col_offset)}function parsestr(a,b){var d=function(a){return decodeURIComponent(a)},e=function(a){for(var c=a.length,d="",e=0;c>e;++e){var f=a[e];if("\\"===f)if(++e,f=a[e],"n"===f)d+="\n";else if("\\"===f)d+="\\";else if("t"===f)d+="    ";else if("r"===f)d+="\r";else if("0"===f)d+="\0";else if('"'===f)d+='"';else if("'"===f)d+="'";else if("\n"===f);else if("x"===f){var g=a[++e],h=a[++e];d+=String.fromCharCode(parseInt(g+h,16))}else if("u"===f||"U"===f){var g=a[++e],h=a[++e],i=a[++e],j=a[++e];d+=String.fromCharCode(parseInt(g+h,16),parseInt(i+j,16))}else goog.asserts.fail("unhandled escape: '"+f.charCodeAt(0)+"'");else d+=f}return d},f=b.charAt(0),g=!1;return"u"===f||"U"===f?(b=b.substr(1),f=b.charAt(0)):("r"===f||"R"===f)&&(b=b.substr(1),f=b.charAt(0),g=!0),goog.asserts.assert("b"!==f&&"B"!==f,"todo; haven't done b'' strings yet"),goog.asserts.assert("'"===f||'"'===f&&b.charAt(b.length-1)===f),b=b.substr(1,b.length-2),b.length>=4&&b.charAt(0)===f&&b.charAt(1)===f&&(goog.asserts.assert(b.charAt(b.length-1)===f&&b.charAt(b.length-2)===f),b=b.substr(2,b.length-4)),g||-1===b.indexOf("\\")?strobj(d(b)):strobj(e(b,f))}function parsestrplus(a,b){REQ(CHILD(b,0),TOK.T_STRING);for(var c=new Sk.builtin.str(""),d=0;NCH(b)>d;++d)c=c.sq$concat(parsestr(a,CHILD(b,d).value));return c}function parsenumber(a,b){var c=b.charAt(b.length-1);if("l"===c||"L"===c)return Sk.longFromStr(b.substr(0,b.length-1));var d=goog.global.eval(b);if((d>Sk.builtin.lng.threshold$||-Sk.builtin.lng.threshold$>d)&&Math.floor(d)===d&&-1===b.indexOf("e")&&-1===b.indexOf("E"))return Sk.longFromStr(b);if(-1!==b.indexOf(".")||-1!==b.indexOf("e")||-1!==b.indexOf("E"))return parseFloat(b);var e=b;return"-"===b.charAt(0)&&(e=b.substr(1)),"0"!==e.charAt(0)||"x"!==e.charAt(1)&&"X"!==e.charAt(1)?"0"!==e.charAt(0)||"b"!==e.charAt(1)&&"B"!==e.charAt(1)?"0"===e.charAt(0)?parseInt(b,8):parseInt(b,10):parseInt(b,2):parseInt(b,16)}function astForSlice(a,b){REQ(b,SYM.subscript);var c=CHILD(b,0),d=null,e=null,f=null;if(c.type===TOK.T_DOT)return new Ellipsis;if(1===NCH(b)&&c.type===SYM.test)return new Index(astForExpr(a,c));if(c.type===SYM.test&&(d=astForExpr(a,c)),c.type===TOK.T_COLON){if(NCH(b)>1){var g=CHILD(b,1);g.type===SYM.test&&(e=astForExpr(a,g))}}else if(NCH(b)>2){var g=CHILD(b,2);g.type===SYM.test&&(e=astForExpr(a,g))}return c=CHILD(b,NCH(b)-1),c.type===SYM.sliceop&&(1===NCH(c)?(c=CHILD(c,0),f=new Name(strobj("None"),Load,c.lineno,c.col_offset)):(c=CHILD(c,1),c.type===SYM.test&&(f=astForExpr(a,c)))),new Slice(d,e,f)}function astForAtom(a,b){var c=CHILD(b,0);switch(c.type){case TOK.T_NAME:return new Name(strobj(c.value),Load,b.lineno,b.col_offset);case TOK.T_STRING:return new Str(parsestrplus(a,b),b.lineno,b.col_offset);case TOK.T_NUMBER:return new Num(parsenumber(a,c.value),b.lineno,b.col_offset);case TOK.T_LPAR:return c=CHILD(b,1),c.type===TOK.T_RPAR?new Tuple([],Load,b.lineno,b.col_offset):c.type===SYM.yield_expr?astForExpr(a,c):NCH(c)>1&&CHILD(c,1).type===SYM.gen_for?astForGenexp(a,c):astForTestlistGexp(a,c);case TOK.T_LSQB:return c=CHILD(b,1),c.type===TOK.T_RSQB?new List([],Load,b.lineno,b.col_offset):(REQ(c,SYM.listmaker),1===NCH(c)||CHILD(c,1).type===TOK.T_COMMA?new List(seqForTestlist(a,c),Load,b.lineno,b.col_offset):astForListcomp(a,c));case TOK.T_LBRACE:c=CHILD(b,1),Math.floor((NCH(c)+1)/4);for(var e=[],f=[],g=0;NCH(c)>g;g+=4)e[g/4]=astForExpr(a,CHILD(c,g)),f[g/4]=astForExpr(a,CHILD(c,g+2));return new Dict(e,f,b.lineno,b.col_offset);case TOK.T_BACKQUOTE:throw new Sk.builtin.SyntaxError("backquote not supported, use repr()");default:goog.asserts.fail("unhandled atom",c.type)}}function astForPower(a,b){REQ(b,SYM.power);var c=astForAtom(a,CHILD(b,0));if(1===NCH(b))return c;for(var d=1;NCH(b)>d;++d){var e=CHILD(b,d);if(e.type!==SYM.trailer)break;var f=astForTrailer(a,e,c);f.lineno=c.lineno,f.col_offset=c.col_offset,c=f}if(CHILD(b,NCH(b)-1).type===SYM.factor){var g=astForExpr(a,CHILD(b,NCH(b)-1));c=new BinOp(c,Pow,g,b.lineno,b.col_offset)}return c}function astForExpr(a,b){a:for(;;){switch(b.type){case SYM.test:case SYM.old_test:if(CHILD(b,0).type===SYM.lambdef||CHILD(b,0).type===SYM.old_lambdef)return astForLambdef(a,CHILD(b,0));if(NCH(b)>1)return astForIfexpr(a,b);case SYM.or_test:case SYM.and_test:if(1===NCH(b)){b=CHILD(b,0);continue a}for(var c=[],d=0;NCH(b)>d;d+=2)c[d/2]=astForExpr(a,CHILD(b,d));return"and"===CHILD(b,1).value?new BoolOp(And,c,b.lineno,b.col_offset):(goog.asserts.assert("or"===CHILD(b,1).value),new BoolOp(Or,c,b.lineno,b.col_offset));case SYM.not_test:if(1===NCH(b)){b=CHILD(b,0);continue a}return new UnaryOp(Not,astForExpr(a,CHILD(b,1)),b.lineno,b.col_offset);case SYM.comparison:if(1===NCH(b)){b=CHILD(b,0);continue a}for(var e=[],f=[],d=1;NCH(b)>d;d+=2)e[(d-1)/2]=astForCompOp(a,CHILD(b,d)),f[(d-1)/2]=astForExpr(a,CHILD(b,d+1));return new Compare(astForExpr(a,CHILD(b,0)),e,f,b.lineno,b.col_offset);case SYM.expr:case SYM.xor_expr:case SYM.and_expr:case SYM.shift_expr:case SYM.arith_expr:case SYM.term:if(1===NCH(b)){b=CHILD(b,0);continue a}return astForBinop(a,b);case SYM.yield_expr:var g=null;return 2===NCH(b)&&(g=astForTestlist(a,CHILD(b,1))),new Yield(g,b.lineno,b.col_offset);case SYM.factor:if(1===NCH(b)){b=CHILD(b,0);continue a}return astForFactor(a,b);case SYM.power:return astForPower(a,b);default:goog.asserts.fail("unhandled expr","n.type: %d",b.type)}break}}function astForPrintStmt(a,b){var c=1,d=null;REQ(b,SYM.print_stmt),NCH(b)>=2&&CHILD(b,1).type===TOK.T_RIGHTSHIFT&&(d=astForExpr(a,CHILD(b,2)),c=4);for(var e=[],f=c,g=0;NCH(b)>f;f+=2,++g)e[g]=astForExpr(a,CHILD(b,f));var h=CHILD(b,NCH(b)-1).type===TOK.T_COMMA?!1:!0;return new Print(d,e,h,b.lineno,b.col_offset)}function astForStmt(a,b){if(b.type===SYM.stmt&&(goog.asserts.assert(1===NCH(b)),b=CHILD(b,0)),b.type===SYM.simple_stmt&&(goog.asserts.assert(1===numStmts(b)),b=CHILD(b,0)),b.type===SYM.small_stmt)switch(REQ(b,SYM.small_stmt),b=CHILD(b,0),b.type){case SYM.expr_stmt:return astForExprStmt(a,b);case SYM.print_stmt:return astForPrintStmt(a,b);case SYM.del_stmt:return astForDelStmt(a,b);case SYM.pass_stmt:return new Pass(b.lineno,b.col_offset);case SYM.flow_stmt:return astForFlowStmt(a,b);case SYM.import_stmt:return astForImportStmt(a,b);case SYM.global_stmt:return astForGlobalStmt(a,b);case SYM.exec_stmt:return astForExecStmt(a,b);case SYM.assert_stmt:return astForAssertStmt(a,b);default:goog.asserts.fail("unhandled small_stmt")}else{var c=CHILD(b,0);switch(REQ(b,SYM.compound_stmt),c.type){case SYM.if_stmt:return astForIfStmt(a,c);case SYM.while_stmt:return astForWhileStmt(a,c);case SYM.for_stmt:return astForForStmt(a,c);case SYM.try_stmt:return astForTryStmt(a,c);case SYM.with_stmt:return astForWithStmt(a,c);case SYM.funcdef:return astForFuncdef(a,c,[]);case SYM.classdef:return astForClassdef(a,c,[]);case SYM.decorated:return astForDecorated(a,c);default:goog.asserts.assert("unhandled compound_stmt")}}}var SYM=Sk.ParseTables.sym,TOK=Sk.Tokenizer.Tokens,operatorMap={};(function(){operatorMap[TOK.T_VBAR]=BitOr,operatorMap[TOK.T_VBAR]=BitOr,operatorMap[TOK.T_CIRCUMFLEX]=BitXor,operatorMap[TOK.T_AMPER]=BitAnd,operatorMap[TOK.T_LEFTSHIFT]=LShift,operatorMap[TOK.T_RIGHTSHIFT]=RShift,operatorMap[TOK.T_PLUS]=Add,operatorMap[TOK.T_MINUS]=Sub,operatorMap[TOK.T_STAR]=Mult,operatorMap[TOK.T_SLASH]=Div,operatorMap[TOK.T_DOUBLESLASH]=FloorDiv,operatorMap[TOK.T_PERCENT]=Mod})(),Sk.astFromParse=function(a,b){var e,c=new Compiling("utf-8",b),d=[],f=0;switch(a.type){case SYM.file_input:for(var g=0;NCH(a)-1>g;++g){var e=CHILD(a,g);if(a.type!==TOK.T_NEWLINE){REQ(e,SYM.stmt);var h=numStmts(e);if(1===h)d[f++]=astForStmt(c,e);else{e=CHILD(e,0),REQ(e,SYM.simple_stmt);for(var i=0;h>i;++i)d[f++]=astForStmt(c,CHILD(e,2*i))}}}return new Module(d);case SYM.eval_input:goog.asserts.fail("todo;");case SYM.single_input:goog.asserts.fail("todo;");default:goog.asserts.fail("todo;")}},Sk.astDump=function(a){var b=function(a){for(var b="",c=0;a>c;++c)b+=" ";return b},c=function(a,d){if(null===a)return d+"None";if(a.prototype&&void 0!==a.prototype._astname&&a.prototype._isenum)return d+a.prototype._astname+"()";if(void 0!==a._astname){for(var e=b(a._astname.length+1),f=[],g=0;a._fields.length>g;g+=2){var h=a._fields[g],i=a._fields[g+1](a),j=b(h.length+1);f.push([h,c(i,d+e+j)])}for(var k=[],g=0;f.length>g;++g){var l=f[g];k.push(l[0]+"="+l[1].replace(/^\s+/,""))}var m=k.join(",\n"+d+e);return d+a._astname+"("+m+")"}if(goog.isArrayLike(a)){for(var n=[],g=0;a.length>g;++g){var o=a[g];n.push(c(o,d+" "))}var p=n.join(",\n");return d+"["+p.replace(/^\s+/,"")+"]"}var q;return q=a===!0?"True":a===!1?"False":a instanceof Sk.builtin.lng?a.tp$str().v:a instanceof Sk.builtin.str?a.$r().v:""+a,d+q};return c(a,"")},goog.exportSymbol("Sk.astFromParse",Sk.astFromParse),goog.exportSymbol("Sk.astDump",Sk.astDump);